<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html>
<ui:composition template="/applayout/dataTemplate.xhtml" xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:b="http://bootsfaces.net/ui"
                xmlns:ng="http://xmlns.jcp.org/jsf/passthrough"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:p="http://primefaces.org/ui" xmlns:butter="http://butterfaces.org/components"
                xmlns:o="http://omnifaces.org/ui">


    <ui:param name="fun_title" value="店面管理"/>
    <ui:define name="search-condition">
        <b:inputText value="#{officeManager.condition}" styleClass="form-control input-block" aria-label="Search"
                     placeholder="查询条件"/>
    </ui:define>
    <ui:define name="search-action">
        <b:commandButton look="default">查询</b:commandButton>
    </ui:define>

    <ui:define name="custom-header">
        <f:metadata>
            <o:viewParam name="officeId" value="#{officeHome.id}" />
        </f:metadata>
    </ui:define>


        <o:form id="editForm" includeViewParams="true">


            <b:modal id="amodal" title="店面" styleClass="modalEdit" >



                <b:messages id="editMessages" globalOnly="false"/>

                <b:inputText value="#{officeHome.instance.id}" required="true" disabled="#{officeHome.managed}"
                             label="编号" renderLabel="true" />


                <b:inputText id="name" value="#{officeHome.instance.name}"
                             label="名称" renderLabel="true" required="true"/>

                <p:outputPanel id="fetchBeanInfo">
                    <b:fetchBeanInfos />
                </p:outputPanel>
                <h:outputScript>
                    var successFailed=true;
                </h:outputScript>
                <f:facet name="footer">
                    <b:button value="取消" dismiss="modal"  onclick="return false;"/>


                    <b:commandButton ajax="true" value="确定"
                                        onsuccess="successFailed = false"
                                        oncomplete="if(!validationFailed &amp;&amp; !successFailed) $('.modalEdit').modal('hide');"
                                     action="#{officeHome.saveOrUpdate}" look="success" update="fetchBeanInfo,editMessages,resultData">
                    </b:commandButton>
                </f:facet>
            </b:modal>

        </o:form>


    <h:form id="resultData">

        <ui:fragment rendered="#{empty officeManager.resultList}">
            <div class="blankslate blankslate-spacious blankslate-large">
                <b:iconAwesome name="search" size="4x" styleClass="blankslate-icon"/>

                <h3>没找到店面.</h3>
                <p>你可以 <a href="/settings/notifications">清空条件</a> 或
                    <b:commandButton value="新建店面" ajax="true" update="editForm"
                                     look="link" process="@this"
                                     oncomplete="$('.modalEdit').modal();">
                        <f:setPropertyActionListener value="" target="#{officeHome.id}"/>
                    </b:commandButton></p>
            </div>
        </ui:fragment>



        <h:dataTable value="#{officeManager.resultList}"
                     styleClass="table table-striped table-hover table-floatThead"
                     headerClass="table-tools-header"
                     columnClasses="width-20percent,width-70percent,width-10percent,width-min"
                     var="_office" rendered="#{not empty officeManager.resultList}">

            <f:facet name="header">
                <b:commandButton value="新建店面" ajax="true" update="editForm"
                                 look="success" process="@this" styleClass="right"
                                 oncomplete="$('.modalEdit').modal();">
                    <f:setPropertyActionListener value="" target="#{officeHome.id}"/>
                </b:commandButton>
                <h3>
                    找到
                    <h:outputText value="#{officeManager.resultList.size()}">
                        <f:convertNumber type="number" groupingUsed="true"/>
                    </h:outputText> 个符合条件的店面
                </h3>
            </f:facet>

            <h:column>
                <f:facet name="header">
                    编号
                </f:facet>
                <h:outputText value="#{_office.id}"/>
            </h:column>
            <h:column>
                <f:facet name="header">
                    名称
                </f:facet>
                <h:outputText value="#{_office.name}"/>
            </h:column>
            <h:column>
                <f:facet name="header">
                    状态
                </f:facet>
                <h:outputText value="#{_office.status}"/>
            </h:column>
            <h:column>
                <f:facet name="header">

                </f:facet>
                <div class="list-actions right">
                    <b:commandButton styleClass="list-action" process="@this" ajax="true" icon="pencil" look="link" oncomplete="$('.modalEdit').modal();" update="editForm">
                        <f:setPropertyActionListener value="#{_office.id}" target="#{officeHome.id}"/>
                    </b:commandButton>
                </div>
            </h:column>


        </h:dataTable>

    </h:form>


    <h:outputScript library="floatThead" name="jquery.floatThead.min.js"/>
    <h:outputScript>
        $(function(){
            $(".table.table-floatThead").floatThead({
                top:50,
                responsiveContainer: function($table){
                    return $table.closest(".table-responsive");
                }
            });
        });
    </h:outputScript>
</ui:composition>